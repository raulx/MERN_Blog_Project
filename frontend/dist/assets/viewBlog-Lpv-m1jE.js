import{e as I,r as j,j as e,c as E,p as M,q as $,s as q,t as z,v as O,m as Q,i as G}from"./index-B_dqLsKw.js";import{i as H,j as J,F as C,f as K,k as L}from"./index.esm-CF2qqmXm.js";import{F as W}from"./footer-BnNBApCN.js";import"./iconBase-cJBVfrGc.js";const D=()=>I(r=>r.user),X=({comment:r,onDelete:c,isBlogByUser:x,onReplyAdd:a,onReplyDelete:o})=>{var g,y;const{userData:u}=D(),[p,h]=j.useState(""),[f,v]=j.useState(!1);return e.jsxs("div",{className:"border-l-2 flex flex-col gap-2 relative  px-8 border-black",children:[e.jsx("div",{className:"h-8 w-8 rounded-full absolute left-0 top-0 -translate-x-1/2",children:e.jsx("img",{className:"w-full h-full rounded-full",src:(g=r.postedBy)==null?void 0:g.profile_pic})}),e.jsx("h1",{className:"font-semibold",children:(y=r.postedBy)==null?void 0:y.name}),e.jsx("p",{className:"text-gray-600",children:r.commentText}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{onClick:()=>v(!f),className:"flex cursor-pointer gap-2 items-center",children:[e.jsxs("span",{children:["replies ",r.replies.length]}),f?e.jsx(H,{}):e.jsx(J,{})]}),r.postedBy._id===u._id||x?e.jsx("button",{onClick:c,className:"w-48 text-sm text-red-600",children:"Delete"}):null]}),f&&e.jsxs("div",{className:"flex flex-col gap-4 ml-4 mt-2",children:[r.replies.map(n=>{var b;return e.jsxs("div",{className:"border-l-2 flex flex-col gap-2 border-black",children:[e.jsxs("div",{className:"flex gap-2 flex-col relative px-8",children:[e.jsx("div",{className:"h-8 w-8 absolute left-0 top-0 -translate-x-1/2 rounded-full",children:e.jsx("img",{className:"w-full h-full rounded-full",src:(b=n.replyPostedBy)==null?void 0:b.profile_pic})}),e.jsx("h1",{children:n.replyPostedBy.name}),e.jsx("p",{children:n.commentText})]}),n.replyPostedBy._id===u._id||x?e.jsx("button",{className:"w-48 self-end text-sm text-red-600",onClick:()=>o(n._id,r._id),children:"Delete"}):null]},n._id)}),e.jsxs("form",{className:"flex justify-center items-center gap-4",onSubmit:n=>a(n,r._id,p,h),children:[e.jsx("input",{placeholder:"Enter your Reply",className:"grow p-2 border-2 rounded-lg",value:p,onChange:n=>h(n.target.value)}),e.jsx("button",{className:"px-4 py-2 bg-blue-600 text-white rounded-lg",type:"submit",children:"Reply"})]})]})]})};function se(){const[r]=E(),c=r.get("blogId"),{userData:x}=D(),[a,o]=j.useState({_id:"",title:"",content:"",views:0,totalLikes:0,isLikedByUser:!1,category:"",image:{public_id:"",remote_url:""},created_by:{_id:"",name:"",email:"",profile_pic:""},createdAt:"",updatedAt:"",comments:[{_id:"",blogId:"",commentText:"",parentId:"",createdAt:"",updatedAt:"",postedBy:{_id:"",name:"",email:"",profile_pic:""},replies:[{_id:"",blogId:"",commentText:"",parentId:"",createdAt:"",updatedAt:"",replyPostedBy:{_id:"",name:"",email:"",profile_pic:""}}]}]}),[u,p]=j.useState(""),[h,{isLoading:f,isFetching:v}]=M(),[g,{isLoading:y}]=$(),[n]=q(),[b]=z(),[w]=O(),B=Q(),_=G(),R=a.created_by._id===x._id;j.useEffect(()=>{(async()=>{try{const t=await h({blogId:c,userId:x._id});t.status==="fulfilled"&&o(l=>({...l,...t.data.data}))}catch(t){console.log(t)}})()},[c,h]);const A=async s=>{s.preventDefault();const t={blogId:c,commentText:u};try{const l=await g(t);l.data&&o(i=>({...i,comments:[l.data.data,...i.comments]}))}catch(l){console.log(l)}p("")},F=async s=>{try{(await w(s)).data&&o(l=>({...l,comments:l.comments.filter(i=>i._id!=s)}))}catch(t){console.log(t.message)}},S=async(s,t,l,i)=>{s.preventDefault();const d={blogId:c,commentText:l,parentId:t};try{const m=await g(d);m.data&&o(k=>({...k,comments:k.comments.map(N=>N._id===t?{...N,replies:[...N.replies,m.data.data]}:N)}))}catch(m){console.log(m)}i("")},U=async(s,t)=>{try{(await w(s)).data&&o(i=>({...i,comments:i.comments.map(d=>d._id===t?{...d,replies:d.replies.filter(m=>m._id!=s)}:d)}))}catch(l){console.log(l)}},P=async()=>{try{if((await b(a._id)).data)o(t=>({...t,isLikedByUser:!0,totalLikes:t.totalLikes+1}));else{const t=`${_.pathname}${_.search}`;B(`/auth?redirect=${encodeURIComponent(t)}`)}}catch(s){console.log(s)}},T=async()=>{try{(await n(a._id)).data&&o(t=>({...t,isLikedByUser:!1,totalLikes:t.totalLikes-1}))}catch(s){console.log(s)}};return e.jsx(e.Fragment,{children:f||v?e.jsx("div",{className:"w-full h-[36rem] flex justify-center items-center",children:e.jsx(C,{className:"animate-spin text-5xl"})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"sm:w-2/3 my-4 w-full flex flex-col gap-4 shadow-lg mx-auto bg-white border rounded-lg border-slate-100 p-4",children:[e.jsx("div",{className:"w-full bg-black",children:e.jsx("div",{className:"sm:w-2/3 h-96 sm:mx-auto",children:e.jsx("img",{className:"w-full h-full object-contain rounded-lg",src:a.image.remote_url})})}),e.jsxs("div",{className:"flex justify-between items-center px-4",children:[e.jsxs("div",{className:"text-3xl uppercase font-bold w-2/3",children:[a.title," the thanos destroyer, saviour of earth,a billionaire"]}),e.jsx("div",{className:" text-gray-400 tracking-wide",children:"Posted On : 22/12/23"})]}),e.jsxs("div",{className:"px-4 flex gap-4",children:[e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsx(K,{}),a.views]}),a.isLikedByUser?e.jsxs("div",{className:"flex items-center gap-4 text-blue-600 cursor-pointer",onClick:T,children:[e.jsx(L,{}),a.totalLikes]}):e.jsxs("div",{className:"flex gap-4 items-center cursor-pointer",onClick:P,children:[e.jsx(L,{})," ",a.totalLikes]})]}),e.jsx("div",{className:"text-lg px-4 leading-8",children:a.content}),e.jsx("div",{className:"px-4 flex justify-end",children:e.jsxs("div",{className:"flex flex-col gap-4 mr-8",children:[e.jsx("div",{className:"font-bold text-black border-b-2",children:"Author:"}),e.jsxs("div",{className:"flex justify-center items-center gap-4",children:[e.jsx("div",{className:"h-8 w-8  rounded-full",children:e.jsx("img",{className:"w-full h-full rounded-full",src:a.created_by.profile_pic})}),e.jsx("div",{className:"font-semibold",children:" Rahul Sinha"})]})]})}),e.jsxs("div",{className:"px-4 font-semibold",children:[a.comments.length," Comments"]}),e.jsx("hr",{className:"h-[2px] bg-gray-300"}),e.jsx("div",{className:"my-8 py-4 px-8 max-h-[500px] overflow-y-scroll scrollbar-none scroll-smooth overflow-x-hidden flex flex-col gap-8",children:a.comments.map(s=>e.jsx(X,{comment:s,isBlogByUser:R,onDelete:()=>F(s._id),onReplyAdd:S,onReplyDelete:U},s._id))}),e.jsxs("form",{className:"flex justify-center items-center gap-4",onSubmit:A,children:[e.jsx("input",{placeholder:"Enter your comment",className:"grow p-4 rounded-lg border",value:u,onChange:s=>p(s.target.value)}),e.jsx("button",{className:"p-4 w-24 bg-blue-600 flex justify-center items-center text-white rounded-lg",type:"submit",children:y?e.jsx(C,{className:"animate-spin"}):e.jsx(e.Fragment,{children:"Post"})})]})]}),e.jsx(W,{})]})})}export{se as default};
